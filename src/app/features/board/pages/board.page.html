<section class="board" aria-labelledby="board-heading">
  <div class="board__overview">
    <mat-card class="board__summary">
      <mat-card-header>
        <div mat-card-avatar class="board__summary-avatar">
          <mat-icon fontSet="material-symbols-rounded">view_kanban</mat-icon>
        </div>
        <mat-card-title id="board-heading">Missões em andamento</mat-card-title>
        <mat-card-subtitle>
          Visual moderno, métricas avançadas e recompensas compartilhadas para manter o squad engajado.
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="board__summary-grid">
          <div class="board__actions" role="group" aria-label="Ações rápidas do quadro">
            <button type="button" mat-flat-button color="primary" (click)="openCreateStory()">
              <mat-icon fontSet="material-symbols-rounded">add_circle</mat-icon>
              Nova história
            </button>
            <button type="button" mat-stroked-button color="accent">
              <mat-icon fontSet="material-symbols-rounded">playlist_add</mat-icon>
              Nova tarefa
            </button>
          </div>

          <div class="board__progress" role="status" aria-live="polite">
            <mat-chip-set class="board__level-chip">
              <mat-chip color="primary" selected>
                <mat-icon matChipAvatar fontSet="material-symbols-rounded">workspace_premium</mat-icon>
                Guilda nível {{ summary().level }}
              </mat-chip>
            </mat-chip-set>
            <mat-progress-bar mode="determinate" [value]="summary().xpProgressPercent"></mat-progress-bar>
            <p>
              {{ summary().xpEarned }} XP acumulado · faltam {{ summary().xpToNextLevel }} XP para o próximo emblema
            </p>
          </div>

          <mat-divider class="board__divider"></mat-divider>

          <div class="board__stats">
            <mat-chip-set>
              <mat-chip variant="outlined">
                <mat-icon matChipAvatar fontSet="material-symbols-rounded">task_alt</mat-icon>
                Histórias concluídas: {{ summary().completedStories }}
              </mat-chip>
              <mat-chip variant="outlined">
                <mat-icon matChipAvatar fontSet="material-symbols-rounded">hub</mat-icon>
                Features ativas: {{ summary().activeFeatures }}
              </mat-chip>
              <mat-chip variant="outlined">
                <mat-icon matChipAvatar fontSet="material-symbols-rounded">monitoring</mat-icon>
                Throughput semanal: {{ summary().weeklyThroughput }}
              </mat-chip>
            </mat-chip-set>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card *ngIf="summary().missions.length > 0" class="board__missions" aria-label="Missões em destaque">
      <mat-card-header>
        <mat-card-title>Missões</mat-card-title>
        <mat-card-subtitle>Objetivos que destravam recompensas extras para a guilda.</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="board__missions-list">
          <article class="mission" *ngFor="let mission of summary().missions">
            <div class="mission__info">
              <mat-icon aria-hidden="true" fontSet="material-symbols-rounded">auto_awesome</mat-icon>
              <div>
                <p class="mission__title">{{ mission.title }}</p>
                <p class="mission__target">{{ mission.target }}</p>
              </div>
            </div>
            <span class="mission__reward">{{ mission.reward }}</span>
            <mat-progress-bar
              class="mission__progress"
              mode="determinate"
              [value]="mission.progress * 100"
              [attr.aria-label]="'Progresso ' + (mission.progress * 100 | number: '1.0-0') + '%'"
            ></mat-progress-bar>
          </article>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <p class="board__definition" role="note">
    <strong>Tarefas</strong> representam os passos táticos para concluir uma história. Elas dividem o trabalho em pequenas ações
    objetivas, dão visibilidade ao progresso diário e ajudam a planejar quem fará o quê em cada sprint.
  </p>

  <section class="board__toolbar" aria-label="Filtros das tarefas">
    <div class="board__filters" role="region" aria-label="Filtrar tarefas por sprint">
      <mat-form-field appearance="fill" class="board__filter">
        <mat-label>Sprint</mat-label>
        <mat-select [value]="selectedSprintId()" (valueChange)="onSprintFilterSelected($event)">
          <mat-option *ngFor="let option of sprintOptions()" [value]="option.id">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </section>

  <section class="board__columns" role="list">
    <kanban-board-column
      *ngFor="let column of columns(); trackBy: trackColumn"
      [column]="column"
      role="listitem"
    ></kanban-board-column>
  </section>

  <kanban-create-story-modal
    *ngIf="isCreatingStory()"
    [features]="features()"
    [statusOptions]="statusOptions()"
    [sprints]="sprints()"
    [activeSprintId]="selectedSprintId()"
    (dismissed)="closeCreateStory()"
    (submitted)="onStorySubmitted($event)"
  ></kanban-create-story-modal>
</section>
