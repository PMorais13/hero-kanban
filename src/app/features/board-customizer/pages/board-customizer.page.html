<section class="board-customizer" aria-labelledby="board-customizer-heading">
  <header class="board-customizer__header">
    <div>
      <h1 id="board-customizer-heading">Personalizar quadro</h1>
      <p>Ative, reorganize e crie novas etapas para ajustar o fluxo às missões da guilda.</p>
    </div>
  </header>

  <section class="board-customizer__statuses" aria-labelledby="status-list-heading">
    <header>
      <h2 id="status-list-heading">Etapas disponíveis</h2>
      <p>Personalize a identidade de cada etapa e organize o fluxo de trabalho na ordem ideal.</p>
    </header>
    <ul
      class="status-list"
      cdkDropList
      [cdkDropListData]="statuses()"
      (cdkDropListDropped)="onStatusDrop($event)"
      aria-describedby="status-list-heading"
    >
      <li
        *ngFor="let status of statuses(); let index = index; trackBy: trackStatus"
        class="status-item"
        cdkDrag
        cdkDragLockAxis="y"
        [cdkDragData]="status"
        [style.--status-icon-color]="status.color"
      >
        <div class="status-item__main">
          <span class="material-symbols-rounded status-item__icon" aria-hidden="true">{{ status.icon }}</span>
          <div class="status-item__info">
            <p class="status-item__title">{{ status.name }}</p>
            <p class="status-item__subtitle">{{ status.description || 'Sem descrição cadastrada.' }}</p>
          </div>
        </div>

        <div class="status-item__meta">
          <div class="status-item__snacks" role="list" aria-label="Resumo da etapa">
            <span class="status-item__snack" role="listitem">Etapa {{ index + 1 }}</span>
            <span
              class="status-item__snack"
              [class.status-item__snack--inactive]="!status.isActive"
              role="listitem"
            >
              {{ status.isActive ? 'Ativa' : 'Inativa' }}
            </span>
          </div>

          <div class="status-item__actions" aria-label="Ações da etapa">
            <button
              type="button"
              class="status-item__drag-handle"
              cdkDragHandle
              [attr.aria-label]="'Reordenar etapa ' + status.name"
              title="Arraste para reordenar"
            >
              <span class="material-symbols-rounded" aria-hidden="true">drag_indicator</span>
            </button>

            <label class="status-item__toggle">
              <input
                type="checkbox"
                [checked]="status.isActive"
                (change)="onStatusToggle(status.id, $event)"
                [attr.aria-label]="'Alternar etapa ' + status.name"
              />
              <span>{{ status.isActive ? 'Ativa' : 'Inativa' }}</span>
            </label>

            <button
              type="button"
              class="status-item__edit"
              (click)="openStatusEditor(status.id)"
              [attr.aria-label]="'Editar etapa ' + status.name"
            >
              <span class="material-symbols-rounded" aria-hidden="true">edit</span>
              Editar
            </button>

            <button
              type="button"
              class="status-item__delete"
              (click)="onDeleteStatus(status)"
              [attr.aria-label]="'Remover etapa ' + status.name"
            >
              <span class="material-symbols-rounded" aria-hidden="true">delete</span>
              Remover
            </button>
          </div>
        </div>
      </li>
    </ul>
  </section>

  <section class="board-customizer__create" aria-labelledby="status-create-heading">
    <header>
      <h2 id="status-create-heading">Criar nova etapa</h2>
      <p>Use nomes únicos com pelo menos três caracteres para manter o fluxo organizado.</p>
    </header>
    <form class="status-form" (submit)="onStatusFormSubmit($event)" aria-label="Criar nova etapa do quadro">
      <div class="status-form__grid">
        <label class="status-form__field" for="new-status-name">
          <span>Nome da etapa</span>
          <input
            id="new-status-name"
            type="text"
            name="new-status-name"
            placeholder="Ex.: Em validação"
            autocomplete="off"
            [value]="newStatusDraft().name"
            (input)="onNewStatusNameInput($event)"
            required
            minlength="3"
          />
        </label>

        <label class="status-form__field" for="new-status-description">
          <span>Descrição</span>
          <textarea
            id="new-status-description"
            name="new-status-description"
            rows="3"
            placeholder="Contexto exibido no quadro"
            [value]="newStatusDraft().description"
            (input)="onNewStatusDescriptionInput($event)"
            required
          ></textarea>
        </label>

        <label class="status-form__field status-form__field--icon" for="new-status-icon">
          <span>Ícone</span>
          <div class="status-form__icon-select">
            <span class="material-symbols-rounded" aria-hidden="true">
              {{ newStatusDraft().icon || 'flag' }}
            </span>
            <select
              id="new-status-icon"
              name="new-status-icon"
              [value]="newStatusDraft().icon"
              (change)="onNewStatusIconChange($event)"
              required
            >
              <option *ngFor="let option of iconOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
        </label>
      </div>

      <div class="status-form__actions">
        <button type="submit" [disabled]="!canCreateStatus()">Adicionar etapa</button>
      </div>

      <p class="status-form__hint" *ngIf="!canCreateStatus()">
        Informe um nome exclusivo, descrição e ícone para a nova etapa.
      </p>
    </form>
  </section>
</section>

<hk-status-editor-modal
  *ngIf="editingStatus() as status"
  [status]="status"
  [iconOptions]="iconOptions"
  (dismissed)="closeStatusEditor()"
  (submitted)="onStatusEditorSubmit($event)"
></hk-status-editor-modal>
