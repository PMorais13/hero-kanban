<section class="home" aria-labelledby="home-heading">
  <div class="home__overview">
    <mat-card class="home__summary">
      <mat-card-header>
        <div mat-card-avatar class="home__summary-avatar">
          <mat-icon fontSet="material-symbols-rounded">view_kanban</mat-icon>
        </div>
        <mat-card-title id="home-heading">Missões em andamento</mat-card-title>
        <mat-card-subtitle>
          Visual moderno, métricas avançadas e recompensas compartilhadas para manter o squad engajado.
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="home__summary-grid">
          <div class="home__actions" role="group" aria-label="Ações rápidas do quadro">
            <a mat-flat-button color="primary" class="home__accent-button" routerLink="/quadro">
              <mat-icon fontSet="material-symbols-rounded" aria-hidden="true">add_circle</mat-icon>
              Nova história
            </a>
          </div>

          <div class="home__progress" role="status" aria-live="polite">
            <mat-chip-set class="home__level-chip-set">
              <mat-chip class="home__level-chip" color="primary" selected>
                <mat-icon matChipAvatar fontSet="material-symbols-rounded">workspace_premium</mat-icon>
                Guilda nível {{ summary().level }}
              </mat-chip>
            </mat-chip-set>
            <mat-progress-bar mode="determinate" [value]="summary().xpProgressPercent"></mat-progress-bar>
            <p>
              {{ summary().xpEarned }} XP acumulado · faltam {{ summary().xpToNextLevel }} XP para o próximo emblema
            </p>
          </div>

          <mat-divider class="home__divider"></mat-divider>

          <div class="home__stats">
            <mat-chip-set>
              <mat-chip class="home__stats-chip" color="primary" selected>
                <mat-icon matChipAvatar fontSet="material-symbols-rounded">task_alt</mat-icon>
                Histórias concluídas: {{ summary().completedStories }}
              </mat-chip>
              <mat-chip class="home__stats-chip" color="primary" selected>
                <mat-icon matChipAvatar fontSet="material-symbols-rounded">hub</mat-icon>
                Features ativas: {{ summary().activeFeatures }}
              </mat-chip>
              <mat-chip class="home__stats-chip" color="primary" selected>
                <mat-icon matChipAvatar fontSet="material-symbols-rounded">monitoring</mat-icon>
                Throughput semanal: {{ summary().weeklyThroughput }}
              </mat-chip>
            </mat-chip-set>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card *ngIf="summary().missions.length > 0" class="home__missions" aria-label="Missões em destaque">
      <mat-card-header>
        <mat-card-title>Missões</mat-card-title>
        <mat-card-subtitle>Objetivos que destravam recompensas extras para a guilda.</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="home__missions-list">
          <article class="mission" *ngFor="let mission of summary().missions">
            <div class="mission__info">
              <mat-icon aria-hidden="true" fontSet="material-symbols-rounded">auto_awesome</mat-icon>
              <div>
                <p class="mission__title">{{ mission.title }}</p>
                <p class="mission__target">{{ mission.target }}</p>
              </div>
            </div>
            <span class="mission__reward">{{ mission.reward }}</span>
            <mat-progress-bar
              class="mission__progress"
              mode="determinate"
              [value]="mission.progress * 100"
              [attr.aria-label]="'Progresso ' + (mission.progress * 100 | number: '1.0-0') + '%'"
            ></mat-progress-bar>
          </article>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="home__conversations" aria-label="Discussões recentes do quadro">
    <mat-card-header>
      <mat-card-title>Discussões recentes</mat-card-title>
      <mat-card-subtitle>Mantenha a guilda informada e destaque menções críticas.</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <section class="home__conversation-thread" aria-label="Comentários mais recentes">
        <ol *ngIf="recentComments().length > 0; else emptyComments" class="home__comment-list">
          <li *ngFor="let entry of recentComments(); trackBy: trackRecentComment" class="home__comment-item">
            <article>
              <header class="home__comment-header">
                <span class="home__comment-author">{{ entry.comment.author }}</span>
                <span class="home__comment-story">
                  {{ entry.storyTitle }} ·
                  <time [attr.datetime]="entry.comment.createdAtIso">
                    {{ entry.comment.createdAtIso | date: 'short' }}
                  </time>
                </span>
              </header>
              <p class="home__comment-message">{{ entry.comment.message }}</p>
              <div *ngIf="entry.comment.mentions.length > 0" class="home__comment-mentions" aria-label="Menções registradas">
                <mat-chip-set>
                  <mat-chip *ngFor="let mention of entry.comment.mentions" color="primary" selected>
                    &#64;{{ mention }}
                  </mat-chip>
                </mat-chip-set>
              </div>
            </article>
          </li>
        </ol>
        <ng-template #emptyComments>
          <p class="home__comment-empty" role="status">
            Ainda não temos conversas registradas aqui. Que tal iniciar uma atualização para o squad?
          </p>
        </ng-template>
      </section>
    </mat-card-content>
  </mat-card>
</section>
